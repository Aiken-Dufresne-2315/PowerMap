# ç©ºé—´ç´¢å¼•ç®—æ³•å¯¹æ¯”åˆ†æ

## æ¦‚è¿°

æœ¬æ–‡æ¡£å¯¹æ¯”åˆ†æç”¨äºåŠ é€Ÿé‡å æ£€æŸ¥çš„å„ç§ç©ºé—´ç´¢å¼•ç®—æ³•ï¼Œå¸®åŠ©é€‰æ‹©æœ€é€‚åˆåœ°é“åœ°å›¾ä¼˜åŒ–é¡¹ç›®çš„æ–¹æ¡ˆã€‚

---

## ç®—æ³•æ€»è§ˆ

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ï¼ˆæŸ¥è¯¢ï¼‰ | æ„å»ºå¤æ‚åº¦ | åŠ¨æ€æ›´æ–° | å®ç°éš¾åº¦ | é€‚ç”¨åœºæ™¯ |
|------|-------------------|-----------|---------|---------|---------|
| **ç©ºé—´ç½‘æ ¼å“ˆå¸Œ** â­ | O(k) | O(V+EÂ·L) | ç®€å• | â­ | å‡åŒ€åˆ†å¸ƒ |
| **R-tree** | O(log N) | O(N log N) | è¾ƒå¤æ‚ | â­â­â­ | éå‡åŒ€åˆ†å¸ƒ |
| **å››å‰æ ‘** | O(log N + k) | O(N log N) | ä¸­ç­‰ | â­â­ | 2Då‡åŒ€æ•°æ® |
| **KD-tree** | O(log N + k) | O(N log N) | å›°éš¾ | â­â­ | ç‚¹æŸ¥è¯¢ |
| **BVH** | O(log N) | O(N log N) | ä¸­ç­‰ | â­â­â­ | å…‰çº¿è¿½è¸ª |
| **æ‰«æçº¿** | O((N+K) log N) | O(N log N) | N/A | â­â­ | æ‰¹é‡æ£€æµ‹ |
| **å±‚æ¬¡åŒ–ç½‘æ ¼** | O(k) | O(V+E) | ç®€å• | â­â­ | å¤šå°ºåº¦æ•°æ® |

â­ = ç®€å•ï¼Œâ­â­â­ = å¤æ‚

---

## 1. ç©ºé—´ç½‘æ ¼å“ˆå¸Œï¼ˆå·²å®ç°ï¼‰âœ…

### åŸç†

å°†ç©ºé—´å‡åŒ€åˆ’åˆ†ä¸ºç½‘æ ¼ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨æ¯ä¸ªç½‘æ ¼å•å…ƒçš„å†…å®¹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ 0,3 â”‚ 1,3 â”‚ 2,3 â”‚ 3,3 â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 0,2 â”‚ V1  â”‚ E2  â”‚ 3,2 â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 0,1 â”‚ E1  â”‚ V2  â”‚ 3,1 â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 0,0 â”‚ 1,0 â”‚ 2,0 â”‚ 3,0 â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

### å¤æ‚åº¦
- **æŸ¥è¯¢**: O(k)ï¼Œkä¸ºå±€éƒ¨å…ƒç´ æ•°é‡
- **æ’å…¥**: O(L)ï¼ŒLä¸ºçº¿æ®µè¦†ç›–çš„ç½‘æ ¼æ•°
- **åˆ é™¤**: O(L)
- **æ„å»º**: O(V + EÂ·L)

### ä¼˜ç‚¹
- âœ… å®ç°ç®€å•
- âœ… æŸ¥è¯¢æå¿«ï¼ˆO(1)å®šä½ç½‘æ ¼ï¼‰
- âœ… å†…å­˜å¯æ§
- âœ… æ”¯æŒåŠ¨æ€æ›´æ–°

### ç¼ºç‚¹
- âŒ ä¸é€‚åˆéå‡åŒ€åˆ†å¸ƒ
- âŒ å‚æ•°é€‰æ‹©å½±å“æ€§èƒ½
- âŒ ç¨€ç–åŒºåŸŸæµªè´¹å†…å­˜

### é€‚ç”¨åœºæ™¯
- âœ… **åœ°é“åœ°å›¾**ï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰
- âœ… æ¸¸æˆç¢°æ’æ£€æµ‹
- âœ… ç²’å­æ¨¡æ‹Ÿ

---

## 2. R-tree / R*-tree

### åŸç†

å±‚æ¬¡åŒ–çš„è¾¹ç•Œæ¡†æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«å­èŠ‚ç‚¹çš„æœ€å°è¾¹ç•ŒçŸ©å½¢ï¼ˆMBRï¼‰ã€‚

```
        æ ¹èŠ‚ç‚¹ [æ•´ä¸ªç©ºé—´]
       /                \
   MBR1 [åŒºåŸŸ1]      MBR2 [åŒºåŸŸ2]
   /    \             /    \
 V1,V2  V3,V4      V5,V6  E1,E2
```

### å¤æ‚åº¦
- **æŸ¥è¯¢**: O(log N)ï¼Œæœ€å O(N)
- **æ’å…¥**: O(log N)
- **åˆ é™¤**: O(log N)
- **æ„å»º**: O(N log N)

### ä¼˜ç‚¹
- âœ… é€‚åˆéå‡åŒ€åˆ†å¸ƒ
- âœ… åŠ¨æ€å¹³è¡¡
- âœ… æ”¯æŒèŒƒå›´æŸ¥è¯¢
- âœ… ç†è®ºæ€§èƒ½å¥½

### ç¼ºç‚¹
- âŒ å®ç°å¤æ‚
- âŒ MBRé‡å å¯¼è‡´æ€§èƒ½ä¸‹é™
- âŒ æ’å…¥/åˆ é™¤éœ€è¦æ ‘é‡æ„
- âŒ ç¼“å­˜ä¸å‹å¥½

### C++ å®ç°

å¯ä»¥ä½¿ç”¨ **Boost.Geometry** åº“ï¼š

```cpp
#include <boost/geometry.hpp>
#include <boost/geometry/index/rtree.hpp>

namespace bg = boost::geometry;
namespace bgi = boost::geometry::index;

// å®šä¹‰ç‚¹å’Œè¾¹ç•Œæ¡†
typedef bg::model::point<double, 2, bg::cs::cartesian> point;
typedef bg::model::box<point> box;
typedef std::pair<box, int> value;

// åˆ›å»ºR-tree
bgi::rtree<value, bgi::quadratic<16>> rtree;

// æ’å…¥å…ƒç´ 
for (int i = 0; i < vertices.size(); ++i) {
    point p(vertices[i].x, vertices[i].y);
    box b(p, p);  // ç‚¹çš„è¾¹ç•Œæ¡†
    rtree.insert(std::make_pair(b, i));
}

// æŸ¥è¯¢é™„è¿‘çš„å…ƒç´ 
box query_box(point(x-r, y-r), point(x+r, y+r));
std::vector<value> result;
rtree.query(bgi::intersects(query_box), std::back_inserter(result));
```

### é€‚ç”¨åœºæ™¯
- âœ… åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰
- âœ… ç©ºé—´æ•°æ®åº“ï¼ˆPostgreSQL PostGISï¼‰
- âœ… éå‡åŒ€åˆ†å¸ƒæ•°æ®
- âš ï¸ åœ°é“åœ°å›¾ï¼ˆå¯èƒ½è¿‡äºå¤æ‚ï¼‰

---

## 3. å››å‰æ ‘ï¼ˆQuadtreeï¼‰

### åŸç†

é€’å½’åœ°å°†2Dç©ºé—´å››ç­‰åˆ†ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å«Nä¸ªå…ƒç´ ã€‚

```
        æ ¹èŠ‚ç‚¹ [å…¨ç©ºé—´]
       /   |   |   \
     NW   NE  SW   SE
    /  \
  NW1  NE1
```

### å¤æ‚åº¦
- **æŸ¥è¯¢**: O(log N + k)
- **æ’å…¥**: O(log N)
- **åˆ é™¤**: O(log N)
- **æ„å»º**: O(N log N)

### ä¼˜ç‚¹
- âœ… å®ç°ç›¸å¯¹ç®€å•
- âœ… è‡ªé€‚åº”ç©ºé—´åˆ’åˆ†
- âœ… æ”¯æŒåŠ¨æ€æ›´æ–°
- âœ… å¯è§†åŒ–ç›´è§‚

### ç¼ºç‚¹
- âŒ æ·±åº¦ä¸å¹³è¡¡
- âŒ è¾¹ç•Œå…ƒç´ å¤„ç†å¤æ‚
- âŒ æœ€åæƒ…å†µé€€åŒ–

### C++ å®ç°ç¤ºä¾‹

```cpp
class QuadTree {
    struct Node {
        double x, y, w, h;  // è¾¹ç•Œ
        std::vector<int> elements;
        Node* children[4];  // NW, NE, SW, SE
        
        bool isLeaf() const { return children[0] == nullptr; }
    };
    
    Node* root;
    const int MAX_CAPACITY = 4;
    const int MAX_DEPTH = 8;
    
public:
    void insert(int id, double x, double y);
    std::vector<int> query(double x, double y, double r);
    
private:
    void subdivide(Node* node);
};
```

### é€‚ç”¨åœºæ™¯
- âœ… 2Dæ¸¸æˆï¼ˆå¦‚MinecraftåŒºå—ï¼‰
- âœ… å›¾åƒå¤„ç†
- âœ… ç¢°æ’æ£€æµ‹
- âš ï¸ åœ°é“åœ°å›¾ï¼ˆçº¿æ®µå¤„ç†å¤æ‚ï¼‰

---

## 4. KD-treeï¼ˆKç»´æ ‘ï¼‰

### åŸç†

åœ¨Kä¸ªç»´åº¦ä¸Šäº¤æ›¿åˆ†å‰²ç©ºé—´ï¼Œæ„å»ºäºŒå‰æœç´¢æ ‘ã€‚

```
        Split on X
       /          \
   X < 5          X >= 5
    |              |
Split on Y    Split on Y
```

### å¤æ‚åº¦
- **æŸ¥è¯¢**: O(log N)ï¼Œkè¿‘é‚» O(log N + k)
- **æ’å…¥**: O(log N)
- **åˆ é™¤**: O(log N)ï¼ˆéœ€è¦é‡æ„ï¼‰
- **æ„å»º**: O(N log N)

### ä¼˜ç‚¹
- âœ… ç‚¹æŸ¥è¯¢å¿«
- âœ… kè¿‘é‚»æœç´¢é«˜æ•ˆ
- âœ… å†…å­˜å ç”¨å°

### ç¼ºç‚¹
- âŒ ä¸é€‚åˆçº¿æ®µ
- âŒ åˆ é™¤éœ€è¦é‡æ„
- âŒ ç»´åº¦ç¾éš¾ï¼ˆé«˜ç»´æ€§èƒ½ä¸‹é™ï¼‰
- âŒ ä¸é€‚åˆèŒƒå›´æŸ¥è¯¢

### é€‚ç”¨åœºæ™¯
- âœ… ç‚¹äº‘æ•°æ®
- âœ… æœ€è¿‘é‚»æœç´¢
- âŒ **ä¸é€‚åˆåœ°é“åœ°å›¾**ï¼ˆçº¿æ®µå¤šï¼‰

---

## 5. åŒ…å›´ä½“å±‚æ¬¡ç»“æ„ï¼ˆBVHï¼‰

### åŸç†

ä¸ºæ¯ä¸ªå¯¹è±¡æ„å»ºå±‚æ¬¡åŒ–çš„åŒ…å›´ç›’ï¼ˆAABBã€OBBæˆ–çƒä½“ï¼‰ã€‚

```
        AABB_root
       /          \
   AABB_1        AABB_2
   /    \        /    \
  E1    E2      E3    E4
```

### å¤æ‚åº¦
- **æŸ¥è¯¢**: O(log N)
- **æ„å»º**: O(N log N)
- **æ›´æ–°**: O(N)ï¼ˆé‡æ„ï¼‰

### ä¼˜ç‚¹
- âœ… å…‰çº¿è¿½è¸ªæœ€ä¼˜
- âœ… å¤„ç†å¤æ‚å‡ ä½•
- âœ… ç¼“å­˜å‹å¥½ï¼ˆå¯ä¼˜åŒ–ï¼‰

### ç¼ºç‚¹
- âŒ å®ç°å¤æ‚
- âŒ åŠ¨æ€åœºæ™¯æ€§èƒ½å·®
- âŒ è¿‡åº¦è®¾è®¡ï¼ˆå¯¹äºåœ°é“åœ°å›¾ï¼‰

### C++ å®ç°ï¼ˆç®€åŒ–ï¼‰

```cpp
struct AABB {
    Coord2 min, max;
    
    bool intersects(const AABB& other) const {
        return !(max.x < other.min.x || min.x > other.max.x ||
                 max.y < other.min.y || min.y > other.max.y);
    }
};

struct BVHNode {
    AABB bounds;
    BVHNode* left;
    BVHNode* right;
    std::vector<int> elements;  // å¶èŠ‚ç‚¹å­˜å‚¨å…ƒç´ 
};
```

### é€‚ç”¨åœºæ™¯
- âœ… 3Dæ¸²æŸ“å¼•æ“
- âœ… å…‰çº¿è¿½è¸ª
- âŒ **ä¸é€‚åˆåœ°é“åœ°å›¾**ï¼ˆ2Dç®€å•å‡ ä½•ï¼‰

---

## 6. æ‰«æçº¿ç®—æ³•ï¼ˆSweep Lineï¼‰

### åŸç†

ä½¿ç”¨ä¸€æ¡æ‰«æçº¿ä»å·¦åˆ°å³ï¼ˆæˆ–ä¸Šåˆ°ä¸‹ï¼‰æ‰«æï¼Œç»´æŠ¤æ´»åŠ¨é›†åˆã€‚

```
æ‰«æçº¿ â†’
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â—              â”‚  æ´»åŠ¨é›†: {}
â”‚     â”â”â”         â”‚  æ´»åŠ¨é›†: {E1}
â”‚  â—     â—        â”‚  æ´»åŠ¨é›†: {E1, V2}
â”‚     â”â”â”   â”â”â”   â”‚  æ´»åŠ¨é›†: {E2}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤æ‚åº¦
- **æ‰¹é‡æ£€æµ‹**: O((N+K) log N)
  - N = å…ƒç´ æ•°é‡
  - K = äº¤å‰å¯¹æ•°é‡

### ä¼˜ç‚¹
- âœ… æ‰¹é‡æ£€æµ‹é«˜æ•ˆ
- âœ… è¾“å‡ºæ•æ„Ÿï¼ˆåªæŠ¥å‘Šé‡å ï¼‰
- âœ… ç»å…¸ç®—æ³•ï¼Œç†è®ºæˆç†Ÿ

### ç¼ºç‚¹
- âŒ ä¸æ”¯æŒåŠ¨æ€æŸ¥è¯¢
- âŒ å®ç°å¤æ‚ï¼ˆäº‹ä»¶é˜Ÿåˆ—ã€å¹³è¡¡æ ‘ï¼‰
- âŒ åªé€‚åˆæ‰¹é‡åœºæ™¯

### ä¼ªä»£ç 

```cpp
struct Event {
    double x;
    enum Type { START, END } type;
    int elementID;
};

std::vector<std::pair<int,int>> sweepLineIntersection(
    const std::vector<Edge>& edges) {
    
    std::priority_queue<Event> events;
    std::set<int> activeSet;  // æ´»åŠ¨è¾¹é›†åˆ
    std::vector<std::pair<int,int>> intersections;
    
    // åˆ›å»ºäº‹ä»¶
    for (const auto& edge : edges) {
        events.push({edge.minX(), Event::START, edge.id});
        events.push({edge.maxX(), Event::END, edge.id});
    }
    
    // å¤„ç†äº‹ä»¶
    while (!events.empty()) {
        Event e = events.top();
        events.pop();
        
        if (e.type == Event::START) {
            // æ£€æŸ¥ä¸æ´»åŠ¨é›†çš„äº¤å‰
            for (int activeID : activeSet) {
                if (intersects(edges[e.elementID], edges[activeID])) {
                    intersections.push_back({e.elementID, activeID});
                }
            }
            activeSet.insert(e.elementID);
        } else {
            activeSet.erase(e.elementID);
        }
    }
    
    return intersections;
}
```

### é€‚ç”¨åœºæ™¯
- âœ… è®¡ç®—å‡ ä½•ï¼ˆçº¿æ®µç›¸äº¤æ£€æµ‹ï¼‰
- âœ… å¤šè¾¹å½¢å¸ƒå°”è¿ç®—
- âŒ **ä¸é€‚åˆåœ°é“åœ°å›¾**ï¼ˆéœ€è¦åŠ¨æ€æŸ¥è¯¢ï¼‰

---

## 7. å±‚æ¬¡åŒ–ç½‘æ ¼ï¼ˆHierarchical Gridï¼‰

### åŸç†

å¤šå±‚æ¬¡çš„ç½‘æ ¼ï¼Œç²—ç²’åº¦å¿«é€Ÿå‰”é™¤ï¼Œç»†ç²’åº¦ç²¾ç¡®æŸ¥è¯¢ã€‚

```
Level 0 (ç²—): 4Ã—4 ç½‘æ ¼ï¼ŒcellSize = 8
Level 1 (ä¸­): 8Ã—8 ç½‘æ ¼ï¼ŒcellSize = 4  
Level 2 (ç»†): 16Ã—16 ç½‘æ ¼ï¼ŒcellSize = 2

æŸ¥è¯¢æµç¨‹: L0å¿«é€Ÿå®šä½ â†’ L1ç¼©å°èŒƒå›´ â†’ L2ç²¾ç¡®æŸ¥è¯¢
```

### å¤æ‚åº¦
- **æŸ¥è¯¢**: O(k)
- **æ’å…¥**: O(L Ã— levels)
- **æ„å»º**: O((V+E) Ã— levels)

### ä¼˜ç‚¹
- âœ… å¤„ç†å¤šå°ºåº¦æ•°æ®
- âœ… æŸ¥è¯¢çµæ´»ï¼ˆå¯é€‰å±‚çº§ï¼‰
- âœ… å¯¹éå‡åŒ€åˆ†å¸ƒå®¹å¿åº¦é«˜

### ç¼ºç‚¹
- âŒ å†…å­˜å ç”¨å¤§
- âŒ å®ç°å¤æ‚åº¦ä¸­ç­‰
- âŒ å‚æ•°è°ƒä¼˜å›°éš¾

### C++ å®ç°éª¨æ¶

```cpp
class HierarchicalGrid {
    struct Level {
        double cellSize;
        std::unordered_map<GridKey, GridCell, GridKeyHash> grid;
    };
    
    std::vector<Level> levels;  // å¤šä¸ªå±‚æ¬¡
    
public:
    HierarchicalGrid(std::vector<double> cellSizes) {
        for (double cs : cellSizes) {
            levels.push_back({cs, {}});
        }
    }
    
    std::vector<int> query(const Coord2& pos) {
        // ä»ç²—åˆ°ç»†æŸ¥è¯¢
        for (int i = 0; i < levels.size(); ++i) {
            auto candidates = levels[i].query(pos);
            if (candidates.size() < threshold) {
                return candidates;  // è¶³å¤Ÿç²¾ç¡®ï¼Œæå‰è¿”å›
            }
        }
        return levels.back().query(pos);  // æœ€ç»†å±‚çº§
    }
};
```

### é€‚ç”¨åœºæ™¯
- âœ… éå‡åŒ€å¯†åº¦æ•°æ®
- âœ… å¤šå°ºåº¦åœ°å›¾ï¼ˆç¼©æ”¾åŠŸèƒ½ï¼‰
- âš ï¸ åœ°é“åœ°å›¾ï¼ˆå¦‚æœå¯†åº¦å·®å¼‚å¤§ï¼‰

---

## ç®—æ³•é€‰æ‹©å†³ç­–æ ‘

```
æ˜¯å¦éœ€è¦åŠ¨æ€æ›´æ–°ï¼Ÿ
â”œâ”€ å¦ â†’ æ‰«æçº¿ç®—æ³•ï¼ˆæ‰¹é‡æ£€æµ‹ï¼‰
â””â”€ æ˜¯
    â”œâ”€ æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ ç©ºé—´ç½‘æ ¼å“ˆå¸Œ â­
    â”‚   â””â”€ å¦ â†’ R-tree æˆ–å±‚æ¬¡åŒ–ç½‘æ ¼
    â”‚
    â”œâ”€ ä¸»è¦æ˜¯ç‚¹æŸ¥è¯¢ï¼Ÿ
    â”‚   â””â”€ æ˜¯ â†’ KD-tree
    â”‚
    â”œâ”€ éœ€è¦ç®€å•å®ç°ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ ç©ºé—´ç½‘æ ¼å“ˆå¸Œ â­
    â”‚   â””â”€ å¦ â†’ R-tree
    â”‚
    â””â”€ 3Dåœºæ™¯æˆ–å¤æ‚å‡ ä½•ï¼Ÿ
        â””â”€ æ˜¯ â†’ BVH
```

---

## é’ˆå¯¹åœ°é“åœ°å›¾çš„æ¨èæ–¹æ¡ˆ

### ğŸ¥‡ é¦–é€‰ï¼šç©ºé—´ç½‘æ ¼å“ˆå¸Œï¼ˆå·²å®ç°ï¼‰

**ç†ç”±**ï¼š
- âœ… åœ°é“ç«™ç‚¹åˆ†å¸ƒç›¸å¯¹å‡åŒ€
- âœ… å®ç°ç®€å•ï¼Œæ˜“äºç»´æŠ¤
- âœ… æŸ¥è¯¢é€Ÿåº¦å¿« O(k)
- âœ… åŠ¨æ€æ›´æ–°ç®€å•
- âœ… æ€§èƒ½æå‡æ˜¾è‘—ï¼ˆ100-1000xï¼‰

**é€‚ç”¨æ¡ä»¶**ï¼š
- ç«™ç‚¹å¯†åº¦ç›¸å¯¹å‡åŒ€
- è¾¹é•¿å·®å¼‚ä¸å¤§ï¼ˆ< 10å€ï¼‰
- åœ°å›¾èŒƒå›´æœ‰é™

---

### ğŸ¥ˆ å¤‡é€‰1ï¼šå±‚æ¬¡åŒ–ç½‘æ ¼

**é€‚ç”¨åœºæ™¯**ï¼š
- å¦‚æœåœ°å›¾æœ‰æ˜æ˜¾çš„å¯†é›†åŒºåŸŸå’Œç¨€ç–åŒºåŸŸ
- éœ€è¦æ”¯æŒå¤šå°ºåº¦æŸ¥è¯¢ï¼ˆç¼©æ”¾ï¼‰

**å®ç°å»ºè®®**ï¼š
```cpp
// 3å±‚ç½‘æ ¼
HierarchicalGrid grid({
    8.0,  // L0: ç²—ç²’åº¦å¿«é€Ÿå‰”é™¤
    2.0,  // L1: ä¸­ç­‰ç²’åº¦
    0.5   // L2: ç²¾ç»†æŸ¥è¯¢
});
```

---

### ğŸ¥‰ å¤‡é€‰2ï¼šR-treeï¼ˆBoostå®ç°ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- ç«™ç‚¹å¯†åº¦æä¸å‡åŒ€ï¼ˆå¦‚éƒŠåŒº vs å¸‚ä¸­å¿ƒï¼‰
- éœ€è¦å·¥ä¸šçº§ç¨³å®šæ€§
- å¯ä»¥æ¥å—é¢å¤–çš„å®ç°å¤æ‚åº¦

**å®ç°å»ºè®®**ï¼š
```cpp
#include <boost/geometry/index/rtree.hpp>

// ä½¿ç”¨Boost.Geometryçš„R-tree
bgi::rtree<value, bgi::rstar<16>> rtree;
```

---

## æ€§èƒ½å¯¹æ¯”ï¼ˆé¢„ä¼°ï¼‰

åŸºäºå…¸å‹åœ°é“ç½‘ç»œï¼ˆV=500, E=800ï¼‰ï¼š

| ç®—æ³• | æŸ¥è¯¢æ—¶é—´ | æ„å»ºæ—¶é—´ | å†…å­˜å ç”¨ | å®ç°å·¥ä½œé‡ |
|------|---------|---------|---------|-----------|
| **ç©ºé—´ç½‘æ ¼** | 0.05 ms | 10 ms | 50 KB | 1å¤© âœ… |
| **å±‚æ¬¡åŒ–ç½‘æ ¼** | 0.08 ms | 30 ms | 150 KB | 3å¤© |
| **R-tree** | 0.10 ms | 50 ms | 80 KB | 1å¤©ï¼ˆç”¨åº“ï¼‰|
| **å››å‰æ ‘** | 0.12 ms | 40 ms | 100 KB | 2å¤© |
| **åŸå§‹éå†** | 10 ms | 0 ms | 0 KB | 0å¤© |

---

## æ··åˆç­–ç•¥

å¯¹äºå¤æ‚åœºæ™¯ï¼Œå¯ä»¥ç»“åˆå¤šç§ç®—æ³•ï¼š

### ç­–ç•¥1ï¼šç²—ç»†ç»“åˆ
```cpp
// ç²—ç½‘æ ¼å¿«é€Ÿå‰”é™¤
SpatialGrid coarseGrid(10.0);
auto candidates = coarseGrid.getNearbyElements(pos);

// ç²¾ç»†ç½‘æ ¼ç²¾ç¡®æŸ¥è¯¢
SpatialGrid fineGrid(1.0);
for (int id : candidates) {
    // ç²¾ç¡®æ£€æµ‹
}
```

### ç­–ç•¥2ï¼šåˆ†åŒºå¤„ç†
```cpp
// å¸‚ä¸­å¿ƒç”¨ç»†ç½‘æ ¼
SpatialGrid downtownGrid(1.0);

// éƒŠåŒºç”¨ç²—ç½‘æ ¼
SpatialGrid suburbanGrid(5.0);

// æ ¹æ®ä½ç½®é€‰æ‹©
if (isInDowntown(pos)) {
    return downtownGrid.query(pos);
} else {
    return suburbanGrid.query(pos);
}
```

---

## å®ç°æˆæœ¬å¯¹æ¯”

| ç®—æ³• | ä»é›¶å®ç° | ä½¿ç”¨åº“ | è°ƒè¯•éš¾åº¦ | ç»´æŠ¤æˆæœ¬ |
|------|---------|-------|---------|---------|
| ç©ºé—´ç½‘æ ¼ | 1-2å¤© | N/A | ä½ | ä½ |
| R-tree | 5-7å¤© | 0.5å¤© | ä¸­ | ä½ï¼ˆåº“ï¼‰ |
| å››å‰æ ‘ | 2-3å¤© | 1å¤© | ä¸­ | ä¸­ |
| KD-tree | 2-3å¤© | 0.5å¤© | ä¸­ | ä½ï¼ˆåº“ï¼‰ |
| BVH | 3-5å¤© | 1å¤© | é«˜ | ä¸­ |
| æ‰«æçº¿ | 3-4å¤© | N/A | é«˜ | ä¸­ |
| å±‚æ¬¡ç½‘æ ¼ | 2-3å¤© | N/A | ä¸­ | ä¸­ |

---

## æ€»ç»“ä¸å»ºè®®

### å½“å‰é¡¹ç›®ï¼ˆåœ°é“åœ°å›¾ä¼˜åŒ–ï¼‰

**æ¨èæ–¹æ¡ˆæ’åº**ï¼š
1. â­â­â­ **ç©ºé—´ç½‘æ ¼å“ˆå¸Œ**ï¼ˆå·²å®ç°ï¼‰- æœ€ä½³é€‰æ‹©
2. â­â­ **å±‚æ¬¡åŒ–ç½‘æ ¼** - å¦‚æœå¯†åº¦å·®å¼‚å¤§
3. â­ **R-treeï¼ˆBoostï¼‰** - éœ€è¦å·¥ä¸šçº§ç¨³å®šæ€§

### ä½•æ—¶è€ƒè™‘æ›¿æ¢

å¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œè€ƒè™‘å‡çº§åˆ°å±‚æ¬¡åŒ–ç½‘æ ¼æˆ–R-treeï¼š
- âŒ å¯†åº¦å·®å¼‚ > 100å€ï¼ˆå¦‚éƒŠåŒºvså¸‚ä¸­å¿ƒï¼‰
- âŒ æŸ¥è¯¢æ€§èƒ½ä¸ç†æƒ³ï¼ˆk > 50ï¼‰
- âŒ å†…å­˜å ç”¨è¿‡å¤§ï¼ˆç¨€ç–åŒºåŸŸæµªè´¹ï¼‰

### ä¸æ¨èçš„æ–¹æ¡ˆ

å¯¹äºåœ°é“åœ°å›¾ä¼˜åŒ–é¡¹ç›®ï¼š
- âŒ **KD-tree** - ä¸é€‚åˆçº¿æ®µ
- âŒ **BVH** - è¿‡åº¦è®¾è®¡
- âŒ **æ‰«æçº¿** - ä¸æ”¯æŒåŠ¨æ€æŸ¥è¯¢

---

## å‚è€ƒèµ„æº

### å¼€æºåº“

1. **Boost.Geometry**
   - R-tree å®ç°
   - æ–‡æ¡£: https://www.boost.org/doc/libs/release/libs/geometry/

2. **nanoflann**
   - KD-tree å®ç°
   - GitHub: https://github.com/jlblancoc/nanoflann

3. **Spatial**
   - å¤šç§ç©ºé—´ç´¢å¼•
   - GitHub: https://github.com/Spatial

### å­¦æœ¯è®ºæ–‡

1. R-tree: Guttman (1984) "R-trees: A Dynamic Index Structure"
2. R*-tree: Beckmann et al. (1990) "The R*-tree: An Efficient Access Method"
3. Spatial Hashing: Teschner et al. (2003) "Optimized Spatial Hashing"

### æ•™ç¨‹

- Computational Geometry: Algorithms and Applications (de Berg et al.)
- Real-Time Collision Detection (Christer Ericson)

---

## ç»“è®º

å¯¹äºå½“å‰çš„åœ°é“åœ°å›¾ä¼˜åŒ–é¡¹ç›®ï¼Œ**ç©ºé—´ç½‘æ ¼å“ˆå¸Œæ˜¯æœ€ä¼˜é€‰æ‹©**ï¼š

âœ… æ€§èƒ½ä¼˜å¼‚ï¼ˆ100-1000xæå‡ï¼‰  
âœ… å®ç°ç®€å•ï¼ˆå·²å®Œæˆï¼‰  
âœ… æ˜“äºç»´æŠ¤  
âœ… æ»¡è¶³éœ€æ±‚  

é™¤éæœªæ¥é‡åˆ°æ˜æ˜¾çš„éå‡åŒ€åˆ†å¸ƒé—®é¢˜ï¼Œå¦åˆ™**æ— éœ€æ›¿æ¢ä¸ºæ›´å¤æ‚çš„ç®—æ³•**ã€‚ä¿æŒç®€å•ï¼Œä¸“æ³¨ä¼˜åŒ–æ ¸å¿ƒé—®é¢˜ã€‚



